<template><div><h2 id="javascript-çº¯å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#javascript-çº¯å‡½æ•°" aria-hidden="true">#</a> JavaScript çº¯å‡½æ•°</h2>
<p><a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/" target="_blank" rel="noopener noreferrer">å‡½æ•°å¼ç¼–ç¨‹æŒ‡åŒ—<ExternalLinkIcon/></a></p>
<p>å‡½æ•°å¼ç¼–ç¨‹ä¸­æœ‰ä¸€ä¸ªæ¦‚å¿µå«çº¯å‡½æ•°ï¼ŒJavaScript ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„èŒƒå¼ï¼Œæ‰€ä»¥ä¹Ÿæœ‰çº¯å‡½æ•°çš„æ¦‚å¿µ</p>
<p>åœ¨ React ä¸­ï¼Œçº¯å‡½æ•°çš„æ¦‚å¿µéå¸¸é‡è¦ï¼ŒReact è¦æ±‚æ‰€æœ‰ç»„ä»¶éƒ½å¿…é¡»åƒçº¯å‡½æ•°ä¸€æ ·ä¿æŠ¤å®ƒä»¬çš„ props ä¸è¢«ä¿®æ”¹ã€‚åœ¨ Redux ä¸­ä¹Ÿéå¸¸é‡è¦ï¼Œæ‰€ä»¥æœ‰å¿…é¡»æ¥å›é¡¾ä¸€ä¸‹çº¯å‡½æ•°ã€‚</p>
<p>çº¯å‡½æ•°çš„ç»´åŸºç™¾ç§‘å®šä¹‰ï¼š</p>
<p>åœ¨ç¨‹åºè®¾è®¡ä¸­ï¼Œè‹¥ä¸€ä¸ªå‡½æ•°ç¬¦åˆä»¥ä¸‹æ¡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°è¢«ç§°ä¸ºçº¯å‡½æ•°ï¼š</p>
<ul>
<li>æ­¤å‡½æ•°åœ¨ç›¸åŒçš„è¾“å…¥å€¼æ—¶ï¼Œéœ€äº§ç”Ÿç›¸åŒçš„è¾“å‡ºã€‚å‡½æ•°çš„è¾“å‡ºå’Œè¾“å…¥å€¼ä»¥å¤–çš„å…¶ä»–éšè—ä¿¡æ¯æˆ–çŠ¶æ€æ— å…³ï¼Œä¹Ÿå’Œç”± I/O è®¾å¤‡äº§ç”Ÿçš„ å¤–éƒ¨è¾“å‡ºæ— å…³</li>
<li>è¯¥å‡½æ•°ä¸èƒ½æœ‰è¯­ä¹‰ä¸Šå¯è§‚å¯Ÿçš„å‡½æ•°å‰¯ä½œç”¨ï¼Œè¯¸å¦‚â€œè§¦å‘äº‹ä»¶â€ï¼Œä½¿è¾“å‡ºè®¾å¤‡è¾“å‡ºï¼Œæˆ–æ›´æ”¹è¾“å‡ºå€¼ä»¥å¤–ç‰©ä»¶çš„å†…å®¹ç­‰</li>
</ul>
<p>å½“ç„¶ä¸Šé¢çš„å®šä¹‰ä¼šè¿‡äºçš„æ™¦æ¶©ï¼Œæ‰€ä»¥ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li><strong>ç¡®å®šçš„è¾“å…¥ï¼Œä¸€å®šä¼šäº§ç”Ÿç¡®å®šçš„è¾“å‡º</strong></li>
<li><strong>å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸èƒ½äº§ç”Ÿå‰¯ä½œç”¨</strong></li>
</ul>
<p>ä¸ºä»€ä¹ˆçº¯å‡½æ•°åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­éå¸¸é‡è¦å‘¢ï¼Ÿ</p>
<ul>
<li>å› ä¸ºä½ å¯ä»¥å®‰å¿ƒçš„å†™å’Œå®‰å¿ƒçš„ç”¨</li>
<li>ä½ åœ¨å†™çš„æ—¶å€™ä¿è¯äº†å‡½æ•°çš„çº¯åº¦ï¼Œåªæ˜¯ä½†æ˜¯å®ç°è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒä¼ å…¥çš„å†…å®¹æˆ–è€…ä¾èµ–å…¶ä»–çš„å¤–éƒ¨å˜é‡</li>
<li>ä½ åœ¨ç”¨çš„æ—¶å€™ï¼Œä½ ç¡®å®šä½ çš„è¾“å…¥å†…å®¹ä¸ä¼šè¢«ä»»æ„ç¯¡æ”¹ï¼Œå¹¶ä¸”è‡ªå·±ç¡®å®šçš„è¾“å…¥ï¼Œä¸€å®šä¼šæœ‰ç¡®å®šçš„è¾“å‡º</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦-redux" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆéœ€è¦-redux" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆéœ€è¦ redux</h2>
<p>JavaScript å¼€å‘çš„åº”ç”¨ç¨‹åºï¼Œå·²ç»å˜å¾—è¶Šæ¥è¶Šå¤æ‚äº†ï¼š</p>
<ul>
<li>JavaScript éœ€è¦ç®¡ç†çš„çŠ¶æ€è¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šå¤æ‚</li>
<li>è¿™äº›çŠ¶æ€åŒ…æ‹¬æœåŠ¡å™¨è¿”å›çš„æ•°æ®ã€ç¼“å­˜æ•°æ®ã€ç”¨æˆ·æ“ä½œäº§ç”Ÿçš„æ•°æ®ç­‰ç­‰ï¼Œä¹ŸåŒ…æ‹¬ä¸€äº› UI çš„çŠ¶æ€ï¼Œæ¯”å¦‚æŸäº›å…ƒç´ æ˜¯å¦è¢«é€‰ä¸­ï¼Œ æ˜¯å¦æ˜¾ç¤ºåŠ è½½åŠ¨æ•ˆï¼Œå½“å‰åˆ†é¡µ</li>
</ul>
<p>ç®¡ç†ä¸æ–­å˜åŒ–çš„ state æ˜¯éå¸¸å›°éš¾çš„ï¼š</p>
<ul>
<li>çŠ¶æ€ä¹‹é—´ç›¸äº’ä¼šå­˜åœ¨ä¾èµ–ï¼Œä¸€ä¸ªçŠ¶æ€çš„å˜åŒ–ä¼šå¼•èµ·å¦ä¸€ä¸ªçŠ¶æ€çš„å˜åŒ–ï¼ŒView é¡µé¢ä¹Ÿæœ‰å¯èƒ½ä¼šå¼•èµ·çŠ¶æ€çš„å˜åŒ–</li>
<li>å½“åº”ç”¨ç¨‹åºå¤æ‚æ—¶ï¼Œstate åœ¨ä»€ä¹ˆæ—¶å€™ï¼Œå› ä¸ºä»€ä¹ˆåŸå› è€Œå‘ç”Ÿäº†å˜åŒ–ï¼Œå‘ç”Ÿäº†æ€ä¹ˆæ ·çš„å˜åŒ–ï¼Œä¼šå˜å¾—éå¸¸éš¾ä»¥æ§åˆ¶å’Œè¿½è¸ª</li>
</ul>
<p>React æ˜¯åœ¨è§†å›¾å±‚å¸®åŠ©æˆ‘ä»¬è§£å†³äº† DOM çš„æ¸²æŸ“è¿‡ç¨‹ï¼Œä½†æ˜¯ State ä¾ç„¶æ˜¯ç•™ç»™æˆ‘ä»¬è‡ªå·±æ¥ç®¡ç†ï¼š</p>
<ul>
<li>æ— è®ºæ˜¯ç»„ä»¶å®šä¹‰è‡ªå·±çš„ stateï¼Œè¿˜æ˜¯ç»„ä»¶ä¹‹é—´çš„é€šä¿¡é€šè¿‡ props è¿›è¡Œä¼ é€’ï¼›ä¹ŸåŒ…æ‹¬é€šè¿‡ Context è¿›è¡Œæ•°æ®ä¹‹é—´çš„å…±äº«ï¼›</li>
<li>React ä¸»è¦è´Ÿè´£å¸®åŠ©æˆ‘ä»¬ç®¡ç†è§†å›¾ï¼Œstate å¦‚ä½•ç»´æŠ¤æœ€ç»ˆè¿˜æ˜¯æˆ‘ä»¬è‡ªå·±æ¥å†³å®š</li>
</ul>
<p>Redux å°±æ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬ç®¡ç† State çš„å®¹å™¨ï¼šRedux æ˜¯ JavaScript çš„çŠ¶æ€å®¹å™¨ï¼Œæä¾›äº†å¯é¢„æµ‹çš„çŠ¶æ€ç®¡ç†</p>
<p>Redux é™¤äº†å’Œ React ä¸€èµ·ä½¿ç”¨ä¹‹å¤–ï¼Œå®ƒä¹Ÿå¯ä»¥å’Œå…¶ä»–ç•Œé¢åº“ä¸€èµ·æ¥ä½¿ç”¨ï¼ˆæ¯”å¦‚ Vueï¼‰ï¼Œå¹¶ä¸”å®ƒéå¸¸å°ï¼ˆåŒ…æ‹¬ä¾èµ–åœ¨å†…ï¼Œåªæœ‰ 2kbï¼‰</p>
<h2 id="redux-çš„æ ¸å¿ƒç†å¿µ-action" tabindex="-1"><a class="header-anchor" href="#redux-çš„æ ¸å¿ƒç†å¿µ-action" aria-hidden="true">#</a> Redux çš„æ ¸å¿ƒç†å¿µ-action</h2>
<p>Redux è¦æ±‚æˆ‘ä»¬é€šè¿‡ action æ¥æ›´æ–°æ•°æ®ï¼š</p>
<ul>
<li>
<p>æ‰€æœ‰æ•°æ®çš„å˜åŒ–ï¼Œå¿…é¡»é€šè¿‡æ´¾å‘ï¼ˆdispatchï¼‰action æ¥æ›´æ–°</p>
</li>
<li>
<p>action æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œç”¨æ¥æè¿°è¿™æ¬¡æ›´æ–°çš„ type å’Œ content</p>
</li>
</ul>
<p>å¼ºåˆ¶ä½¿ç”¨ action çš„å¥½å¤„æ˜¯å¯ä»¥æ¸…æ™°çš„çŸ¥é“æ•°æ®åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆæ ·çš„å˜åŒ–ï¼Œæ‰€æœ‰çš„æ•°æ®å˜åŒ–éƒ½æ˜¯å¯è·Ÿè¿½ã€å¯é¢„æµ‹çš„</p>
<h2 id="redux-çš„æ ¸å¿ƒç†å¿µ-reducer" tabindex="-1"><a class="header-anchor" href="#redux-çš„æ ¸å¿ƒç†å¿µ-reducer" aria-hidden="true">#</a> Redux çš„æ ¸å¿ƒç†å¿µ - reducer</h2>
<p>ä½†æ˜¯å¦‚ä½•å°† state å’Œ action è”ç³»åœ¨ä¸€èµ·å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ reducer</p>
<ul>
<li>reducer æ˜¯ä¸€ä¸ª<strong>çº¯å‡½æ•°</strong></li>
<li>reducer åšçš„äº‹æƒ…å°±æ˜¯å°†ä¼ å…¥çš„ state å’Œ action ç»“åˆèµ·æ¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ state</li>
</ul>
<h2 id="redux-çš„ä¸‰å¤§åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#redux-çš„ä¸‰å¤§åŸåˆ™" aria-hidden="true">#</a> Redux çš„ä¸‰å¤§åŸåˆ™</h2>
<h3 id="å•ä¸€æ•°æ®æº" tabindex="-1"><a class="header-anchor" href="#å•ä¸€æ•°æ®æº" aria-hidden="true">#</a> å•ä¸€æ•°æ®æº</h3>
<ul>
<li>æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ state è¢«å­˜å‚¨åœ¨ä¸€é¢— object tree ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ª object tree åªå­˜å‚¨åœ¨ä¸€ä¸ª store ä¸­</li>
<li>Redux å¹¶æ²¡æœ‰å¼ºåˆ¶è®©æˆ‘ä»¬ä¸èƒ½åˆ›å»ºå¤šä¸ª Storeï¼Œä½†æ˜¯é‚£æ ·åšå¹¶ä¸åˆ©äºæ•°æ®çš„ç»´æŠ¤</li>
<li>å•ä¸€çš„æ•°æ®æºå¯ä»¥è®©æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ state å˜å¾—æ–¹ä¾¿ç»´æŠ¤ã€è¿½è¸ªã€ä¿®æ”¹</li>
</ul>
<h3 id="state-æ˜¯åªè¯»çš„" tabindex="-1"><a class="header-anchor" href="#state-æ˜¯åªè¯»çš„" aria-hidden="true">#</a> State æ˜¯åªè¯»çš„</h3>
<ul>
<li>å”¯ä¸€ä¿®æ”¹ State çš„æ–¹æ³•ä¸€å®šæ˜¯è§¦å‘ actionï¼Œä¸è¦è¯•å›¾åœ¨å…¶ä»–åœ°æ–¹é€šè¿‡ä»»ä½•çš„æ–¹å¼æ¥ä¿®æ”¹ State</li>
<li>è¿™æ ·å°±ç¡®ä¿äº† View æˆ–ç½‘ç»œè¯·æ±‚éƒ½ä¸èƒ½ç›´æ¥ä¿®æ”¹ stateï¼Œå®ƒä»¬åªèƒ½é€šè¿‡ action æ¥æè¿°è‡ªå·±æƒ³è¦å¦‚ä½•ä¿®æ”¹ state</li>
<li>è¿™æ ·å¯ä»¥ä¿è¯æ‰€æœ‰çš„ä¿®æ”¹éƒ½è¢«é›†ä¸­åŒ–å¤„ç†ï¼Œå¹¶ä¸”æŒ‰ç…§ä¸¥æ ¼çš„é¡ºåºæ¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹…å¿ƒ race conditionï¼ˆç«Ÿæ€ï¼‰çš„é—®é¢˜</li>
</ul>
<h3 id="ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹" aria-hidden="true">#</a> ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹</h3>
<ul>
<li>é€šè¿‡ reducer å°† æ—§ state å’Œ actions è”ç³»åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªæ–°çš„ State</li>
<li>éšç€åº”ç”¨ç¨‹åºçš„å¤æ‚åº¦å¢åŠ ï¼Œæˆ‘ä»¬å¯ä»¥å°† reducer æ‹†åˆ†æˆå¤šä¸ªå°çš„ reducersï¼Œåˆ†åˆ«æ“ä½œä¸åŒ state tree çš„ä¸€éƒ¨åˆ†</li>
<li>ä½†æ˜¯æ‰€æœ‰çš„ reducer éƒ½åº”è¯¥æ˜¯çº¯å‡½æ•°ï¼Œä¸èƒ½äº§ç”Ÿä»»ä½•çš„å‰¯ä½œç”¨</li>
</ul>
<h2 id="redux-ä½¿ç”¨æµç¨‹" tabindex="-1"><a class="header-anchor" href="#redux-ä½¿ç”¨æµç¨‹" aria-hidden="true">#</a> Redux ä½¿ç”¨æµç¨‹</h2>
<p><img src="https://zfh-nanjing-bucket.oss-cn-nanjing.aliyuncs.com/blog-images/reduxä½¿ç”¨æµç¨‹.png" alt="reduxä½¿ç”¨æµç¨‹" loading="lazy"></p>
<h2 id="åœ¨-react-é¡¹ç›®ä¸­ä½¿ç”¨-redux" tabindex="-1"><a class="header-anchor" href="#åœ¨-react-é¡¹ç›®ä¸­ä½¿ç”¨-redux" aria-hidden="true">#</a> åœ¨ react é¡¹ç›®ä¸­ä½¿ç”¨ redux</h2>
<ol>
<li>åˆ›å»º store æ–‡ä»¶å¤¹ï¼Œåˆ›å»º 4 ä¸ªæ–‡ä»¶ï¼šactionCreators.jsï¼ˆåˆ›å»º action çš„æ–‡ä»¶ï¼‰ï¼Œconstants.jsï¼ˆå®šä¹‰ action åç§°å¸¸é‡),reducer.js(å°† aciton å’Œ state è”ç³»åœ¨ä¸€èµ·)ï¼Œindex.js(å¯¼å‡ºåˆ›å»ºå¥½çš„ store)</li>
</ol>
<p>è¿™é‡Œå®ç°ä¸€ä¸ªç®€å•çš„ couter æ¡ˆä¾‹ï¼š</p>
<details class="custom-container details"><summary>actionCreators.js</summary>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">JIA_ACTION</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token constant">JIAA_ACTION</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token constant">JIA_ACTION</span><span class="token punctuation">,</span>
    num<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<details class="custom-container details"><summary>constants.js</summary>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">JIA_ACTION</span> <span class="token operator">=</span> <span class="token string">'JIA_ACTION'</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></details>
<details class="custom-container details"><summary>reducer.js</summary>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">JIA_ACTION</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span>

<span class="token keyword">const</span> defaultStore <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultStore<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">JIA_ACTION</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">counter</span><span class="token operator">:</span> action<span class="token punctuation">.</span>num <span class="token operator">+</span> state<span class="token punctuation">.</span>counter <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<details class="custom-container details"><summary>index.js</summary>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<ol start="2">
<li>æ¥ç€åˆ›å»º utils æ–‡ä»¶å¤¹ï¼Œè¿™é‡Œç¼–å†™ connect å·¥å…·å‡½æ•°ã€‚åˆ›å»º connect.js(æŠ½è±¡ react ä¸ redux è¿æ¥é€»è¾‘çš„å·¥å…·å‡½æ•°)ï¼Œcontext.js(åˆ©ç”¨ context å…¨å±€å…±äº« store)</li>
</ol>
<details class="custom-container details"><summary>connect.js</summary>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> storeContext <span class="token keyword">from</span> <span class="token string">'./context'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token parameter">mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">enhanceHOC</span><span class="token punctuation">(</span><span class="token parameter">WrapperComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">ReduxConnect</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">storeState</span><span class="token operator">:</span> context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>WrapperComponent
              <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span>
              <span class="token punctuation">{</span><span class="token operator">...</span><span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
              <span class="token punctuation">{</span><span class="token operator">...</span><span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(this.context)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>unsubscribe <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// { counter:1}</span>
            <span class="token literal-property property">storeState</span><span class="token operator">:</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    ReduxConnect<span class="token punctuation">.</span>contextType <span class="token operator">=</span> storeContext
    <span class="token keyword">return</span> ReduxConnect
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<details class="custom-container details"><summary>context.js</summary>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> StoreContext <span class="token operator">=</span> react<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> StoreContext
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<ol start="3">
<li>åœ¨é¡¹ç›® index.js æ–‡ä»¶ä¸­å¼•å…¥ storeï¼Œåˆ©ç”¨ StoreContext çš„ Provider ç»„ä»¶ï¼Œè®© App ç»„ä»¶å…±äº« store</li>
</ol>
<div class="language-jsx ext-jsx line-numbers-mode"><pre v-pre class="language-jsx"><code><span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">'./redux/store'</span>
<span class="token keyword">import</span> StoreContext <span class="token keyword">from</span> <span class="token string">'./redux/utils/context'</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">StoreContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">StoreContext.Provider</span></span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4">
<li>åœ¨æƒ³è¦ä½¿ç”¨ store çš„ç»„ä»¶ä¸­å®šä¹‰ mapStateToProps,mapDispatchToPropsã€‚æŠŠéœ€è¦çš„ state å’Œ dispatch æ˜ å°„åˆ°æƒ³è¦ä½¿ç”¨ store çš„ç»„ä»¶çš„ props ä¸­</li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PureComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> connect <span class="token keyword">from</span> <span class="token string">'./utils/connect'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">JIAA_ACTION</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./store/actionCreators'</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">counter</span><span class="token operator">:</span> state<span class="token punctuation">.</span>counter<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token parameter">dispatch</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token constant">JIAA_ACTION</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> PureComponent <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>counter<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button
          onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">></span>
          <span class="token operator">+</span><span class="token number">3</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> EnApp <span class="token operator">=</span> <span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> EnApp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è™½ç„¶å·²ç»å®ç°äº† connectã€Provider è¿™äº›å¸®åŠ©æˆ‘ä»¬å®Œæˆè¿æ¥ reduxã€react çš„è¾…åŠ©å·¥å…·ï¼Œä½†æ˜¯å®é™…ä¸Š redux å®˜æ–¹æä¾›äº† react-redux çš„åº“ï¼Œå¯ä»¥ç›´æ¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”å®ç°çš„é€»è¾‘ä¼šæ›´åŠ çš„ä¸¥è°¨å’Œé«˜æ•ˆ</p>
<ol>
<li>å®‰è£…ï¼šyarn add react-redux</li>
<li>åœ¨ index.js ä¸­å°† Provider ç»„ä»¶æ›¿æ¢æˆ react-redux ä¸­çš„ Provider ç»„ä»¶</li>
</ol>
<div class="language-jsx ext-jsx line-numbers-mode"><pre v-pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3">
<li>ç»„ä»¶ä¸­å°† connect æ›¿æ¢æˆ react-redux ä¸­ connect</li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> connect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-redux'</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="redux-ä¸­å¼‚æ­¥æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#redux-ä¸­å¼‚æ­¥æ“ä½œ" aria-hidden="true">#</a> redux ä¸­å¼‚æ­¥æ“ä½œ</h2>
<p>â€‹ äº‹å®ä¸Šï¼Œç½‘ç»œè¯·æ±‚åˆ°çš„æ•°æ®ä¹Ÿå±äºæˆ‘ä»¬çŠ¶æ€ç®¡ç†çš„ä¸€éƒ¨åˆ†ï¼Œæ›´å¥½çš„ä¸€ç§æ–¹å¼åº”è¯¥æ˜¯å°†å…¶ä¹Ÿäº¤ç»™ redux æ¥ç®¡ç†</p>
<p><img src="https://zfh-nanjing-bucket.oss-cn-nanjing.aliyuncs.com/blog-images/redux-å¼‚æ­¥æ“ä½œ.png" alt="redux-å¼‚æ­¥æ“ä½œ" loading="lazy"></p>
<p>ä½†æ˜¯åœ¨ redux ä¸­å¦‚ä½•å¯ä»¥è¿›è¡Œå¼‚æ­¥çš„æ“ä½œå‘¢ï¼Ÿ</p>
<ul>
<li>ç­”æ¡ˆå°±æ˜¯ä½¿ç”¨ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰</li>
<li>å­¦ä¹ è¿‡ Express æˆ– Koa æ¡†æ¶çš„ç«¥é‹å¯¹ä¸­é—´ä»¶çš„æ¦‚å¿µä¸€å®šä¸é™Œç”Ÿ</li>
<li>åœ¨è¿™ç±»æ¡†æ¶ä¸­ï¼ŒMiddleware å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨è¯·æ±‚å’Œå“åº”ä¹‹é—´åµŒå…¥ä¸€äº›æ“ä½œçš„ä»£ç ï¼Œæ¯”å¦‚ cookie è§£æã€æ—¥å¿—è®°å½•ã€æ–‡ä»¶å‹ç¼©ç­‰æ“ä½œ</li>
</ul>
<h3 id="ç†è§£ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#ç†è§£ä¸­é—´ä»¶" aria-hidden="true">#</a> ç†è§£ä¸­é—´ä»¶</h3>
<p>redux ä¹Ÿå¼•å…¥äº†ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰çš„æ¦‚å¿µï¼š</p>
<ul>
<li>
<p>è¿™ä¸ªä¸­é—´ä»¶çš„ç›®çš„æ˜¯åœ¨ dispatch çš„ action å’Œæœ€ç»ˆè¾¾åˆ°çš„ reducer ä¹‹é—´ï¼Œæ‰©å±•ä¸€äº›è‡ªå·±çš„ä»£ç ã€‚æ¯”å¦‚æ—¥å¿—è®°å½•ã€è°ƒç”¨å¼‚æ­¥æ¥å£ã€æ·»åŠ ä»£ç è°ƒè¯•åŠŸèƒ½ç­‰ç­‰</p>
</li>
<li>
<p>æˆ‘ä»¬ç°åœ¨è¦åšçš„äº‹æƒ…å°±æ˜¯å‘é€å¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ·»åŠ å¯¹åº”çš„ä¸­é—´ä»¶ã€‚å®˜ç½‘æ¨èçš„ã€åŒ…æ‹¬æ¼”ç¤ºçš„ç½‘ç»œè¯·æ±‚çš„ä¸­é—´ä»¶æ˜¯ä½¿ç”¨ redux-thunk</p>
</li>
</ul>
<p>redux-thunk æ˜¯å¦‚ä½•åšåˆ°è®©æˆ‘ä»¬å¯ä»¥å‘é€å¼‚æ­¥çš„è¯·æ±‚å‘¢ï¼Ÿ</p>
<ul>
<li>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œé»˜è®¤æƒ…å†µä¸‹çš„ dispatch(action)ï¼Œaction éœ€è¦æ˜¯ä¸€ä¸ª JavaScript çš„å¯¹è±¡</p>
</li>
<li>
<p>redux-thunk å¯ä»¥è®© dispatch(action å‡½æ•°)ï¼Œaction å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°</p>
</li>
<li>
<p>è¯¥å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¸”ä¼šä¼ ç»™è¿™ä¸ªå‡½æ•°ä¸€ä¸ª dispatch å‡½æ•°å’Œ getState å‡½æ•°ï¼š</p>
<ul>
<li>dispatch å‡½æ•°ç”¨äºæˆ‘ä»¬ä¹‹åå†æ¬¡æ´¾å‘ action</li>
<li>getState å‡½æ•°è€ƒè™‘åˆ°æˆ‘ä»¬ä¹‹åçš„ä¸€äº›æ“ä½œéœ€è¦ä¾èµ–åŸæ¥çš„çŠ¶æ€ï¼Œç”¨äºè®©æˆ‘ä»¬å¯ä»¥è·å–ä¹‹å‰çš„ä¸€äº›çŠ¶æ€</li>
</ul>
</li>
</ul>
<h3 id="ä½¿ç”¨-redux-thunk" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-redux-thunk" aria-hidden="true">#</a> ä½¿ç”¨ redux-thunk</h3>
<ol>
<li>
<p>å®‰è£… redux-thunk:<code v-pre>yarn add redux-thunk</code></p>
</li>
<li>
<p>åœ¨åˆ›å»º store æ—¶ä¼ å…¥åº”ç”¨äº† middleware çš„ enhance å‡½æ•°</p>
<ul>
<li>é€šè¿‡ applyMiddleware æ¥ç»“åˆå¤šä¸ª Middleware, è¿”å›ä¸€ä¸ª enhancer</li>
<li>å°† enhancer ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥åˆ° createStore ä¸­</li>
</ul>
</li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> thunkMiddleware <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>
<span class="token keyword">const</span> storeEnhancer <span class="token operator">=</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunkMiddleware<span class="token punctuation">)</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> storeEnhancer<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3">
<li>åœ¨ actionCreators.js å®šä¹‰ä¸€ä¸ªè¿”å›å‡½æ•°çš„ actionï¼š</li>
</ol>
<ul>
<li>æ³¨æ„ï¼šè¿™é‡Œä¸æ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡äº†ï¼Œè€Œæ˜¯ä¸€ä¸ªå‡½æ•°</li>
<li>è¯¥å‡½æ•°åœ¨ dispatch ä¹‹åä¼šè¢«æ‰§è¡Œ</li>
</ul>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getbannerDataAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token parameter">dispath</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react-thuckæ•°æ®æ¥å—æˆåŠŸ'</span><span class="token punctuation">)</span>
      axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://123.207.32.32:8000/home/multidata'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token comment">// console.log(res)</span>
        <span class="token comment">// console.log(res.data.data.banner.list)</span>
        <span class="token function">dispath</span><span class="token punctuation">(</span><span class="token function">bannerAction</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>banner<span class="token punctuation">.</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4">
<li>æ˜ å°„è¯¥ action çš„ dispatch æ“ä½œ,å’Œç›¸å…³çš„ store ä¸­çš„ stateï¼š</li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">banner</span><span class="token operator">:</span> state<span class="token punctuation">.</span>banner<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token parameter">dispatch</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">getbanner</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">getbannerDataAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5">
<li>åœ¨ componentDidMount è°ƒç”¨ï¼Œå°±å¯ä»¥æ‹¿åˆ°æ•°æ®</li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code>    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">getbanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>banner<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redux-devtools" tabindex="-1"><a class="header-anchor" href="#redux-devtools" aria-hidden="true">#</a> redux-devtools</h2>
<p>åˆ©ç”¨è¿™ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æ¯æ¬¡çŠ¶æ€æ˜¯å¦‚ä½•è¢«ä¿®æ”¹çš„ï¼Œä¿®æ”¹å‰åçš„çŠ¶æ€å˜åŒ–ç­‰ç­‰</p>
<ol>
<li>åœ¨å¯¹åº”çš„æµè§ˆå™¨ä¸­å®‰è£…ç›¸å…³çš„æ’ä»¶ï¼ˆChrome æµè§ˆå™¨æ‰©å±•å•†åº—ä¸­æœç´¢ Redux DevTools å³å¯</li>
<li>å¯¹ store çš„ index.js è¿›è¡Œæ”¹é€ </li>
</ol>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore<span class="token punctuation">,</span> applyMiddleware<span class="token punctuation">,</span> compose <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span>
<span class="token keyword">import</span> thunkMiddleware <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span>
<span class="token comment">// åº”ç”¨ä¸­é—´ä»¶</span>
<span class="token keyword">const</span> storeEnhancer <span class="token operator">=</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span>thunkMiddleware<span class="token punctuation">)</span>
<span class="token comment">// åˆå¹¶å¤šä¸ªenhancer</span>
<span class="token keyword">const</span> composeEnhancers <span class="token operator">=</span>
  window<span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION_COMPOSE__</span><span class="token punctuation">(</span>tra<span class="token punctuation">)</span> <span class="token operator">||</span> compose
<span class="token comment">// å®˜æ–¹ä¸æ¨ècreateStore éœ€è¦ä½¿ç”¨reduxå·¥å…·åŒ…ğŸ”§</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">composeEnhancers</span><span class="token punctuation">(</span>storeEnhancer<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºåŸºæœ¬çš„ redux,åªéœ€è¦æ·»åŠ ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>
  reducer <span class="token comment">/* preloadedState, */</span><span class="token punctuation">,</span>
  <span class="token operator">+</span>window<span class="token punctuation">.</span>__REDUX_DEVTOOLS_EXTENSION__ <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span><span class="token function">__REDUX_DEVTOOLS_EXTENSION__</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redux-ä»£ç æ–‡ä»¶æ‹†åˆ†" tabindex="-1"><a class="header-anchor" href="#redux-ä»£ç æ–‡ä»¶æ‹†åˆ†" aria-hidden="true">#</a> Redux ä»£ç æ–‡ä»¶æ‹†åˆ†</h2>
<p>éšç€é¡¹ç›®çš„ä¸æ–­æ‰©å¤§ï¼Œå¯èƒ½å¯¼è‡´ store ç»“æ„è¶Šæ¥è¶Šå¤æ‚ï¼Œaction è¶Šæ¥è¶Šå¤šã€‚æ‰€æœ‰æœ‰å¿…è¦å¯¹ä»£ç ç»“æ„è¿›è¡Œæ‹†åˆ†</p>
<p>ä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://zfh-nanjing-bucket.oss-cn-nanjing.aliyuncs.com/blog-images/reduxä»£ç æ‹†åˆ†.png" alt="reduxä»£ç æ‹†åˆ†" loading="lazy"></p>
<p>ä¸»ç›®å½• reducer.js:</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> counterReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./counter'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bannerReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./banner'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">counterInfo</span><span class="token operator">:</span> <span class="token function">counterReducer</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>counterInfo<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">bannerInfo</span><span class="token operator">:</span> <span class="token function">bannerReducer</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>bannerInfo<span class="token punctuation">,</span> action<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Banner.js</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">GET_BANNER_DATA</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./constants'</span>
<span class="token comment">// banneré»˜è®¤æ•°æ®</span>
<span class="token keyword">const</span> defaultBannerState <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">banner</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// bannerç‹¬æœ‰çš„reduceré€»è¾‘</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">bannerReducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> defaultBannerState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token constant">GET_BANNER_DATA</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token literal-property property">banner</span><span class="token operator">:</span> action<span class="token punctuation">.</span>banner <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="combinereducers-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#combinereducers-å‡½æ•°" aria-hidden="true">#</a> combineReducers å‡½æ•°</h2>
<p>ç›®å‰æˆ‘ä»¬åˆå¹¶çš„æ–¹å¼æ˜¯é€šè¿‡æ¯æ¬¡è°ƒç”¨ reducer å‡½æ•°è‡ªå·±æ¥è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡</p>
<p>äº‹å®ä¸Šï¼Œredux ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª combineReducers å‡½æ•°å¯ä»¥æ–¹ä¾¿çš„è®©æˆ‘ä»¬å¯¹å¤šä¸ª reducer è¿›è¡Œåˆå¹¶ï¼š</p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> counterReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./counter'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> bannerReducer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./banner'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>

<span class="token keyword">const</span> reducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">counterInfo</span><span class="token operator">:</span> counterReducer<span class="token punctuation">,</span>
  <span class="token literal-property property">bannerInfo</span><span class="token operator">:</span> bannerReducer<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div></template>


